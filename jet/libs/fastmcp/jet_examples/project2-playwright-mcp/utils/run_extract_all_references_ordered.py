import json
from pathlib import Path
import shutil
from page_utils import extract_all_references_ordered
from rich import print

def get_entry_file_dir() -> Path:
    return Path(__file__).parent.resolve()

def get_entry_file_name() -> str:
    return Path(__file__).name

BASE_OUTPUT_DIR = Path(get_entry_file_dir()) / "generated" / Path(get_entry_file_name()).stem
shutil.rmtree(BASE_OUTPUT_DIR, ignore_errors=True)

snapshot_str = '[\n  {\n    "generic [active] [ref=e1]": [\n      {\n        "main [ref=e2]": [\n          {\n            "navigation [ref=e3]": [\n              {\n                "link \\"About\\" [ref=e4] [cursor=pointer]": [\n                  {\n                    "/url": "/info/en/about"\n                  },\n                  "img [ref=e5]",\n                  {\n                    "generic [ref=e9]": "About"\n                  }\n                ]\n              },\n              {\n                "link \\"Preferences\\" [ref=e10] [cursor=pointer]": [\n                  {\n                    "/url": "/preferences"\n                  },\n                  "img [ref=e11]",\n                  {\n                    "generic [ref=e13]": "Preferences"\n                  }\n                ]\n              }\n            ]\n          },\n          {\n            "search [ref=e14]": [\n              {\n                "generic [ref=e15]": [\n                  {\n                    "link \\"Display the front page\\" [ref=e16] [cursor=pointer]": [\n                      {\n                        "/url": "/"\n                      },\n                      "img [ref=e17]"\n                    ]\n                  },\n                  {\n                    "generic [ref=e23]": [\n                      {\n                        "textbox \\"Search for...\\" [ref=e24]": "Playwright MCP agents"\n                      },\n                      {\n                        "button \\"clear\\" [ref=e25]": [\n                          "img [ref=e27]"\n                        ]\n                      },\n                      {\n                        "button \\"search\\" [ref=e29]": [\n                          "img [ref=e31]"\n                        ]\n                      },\n                      {\n                        "generic": [\n                          "list"\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "generic [ref=e35]": [\n                      {\n                        "button \\"general\\" [ref=e36] [cursor=pointer]": [\n                          "img [ref=e37]",\n                          {\n                            "generic [ref=e40]": "general"\n                          }\n                        ]\n                      },\n                      {\n                        "button \\"images\\" [ref=e41] [cursor=pointer]": [\n                          "img [ref=e42]",\n                          {\n                            "generic [ref=e46]": "images"\n                          }\n                        ]\n                      },\n                      {\n                        "button \\"videos\\" [ref=e47] [cursor=pointer]": [\n                          "img [ref=e48]",\n                          {\n                            "generic [ref=e50]": "videos"\n                          }\n                        ]\n                      },\n                      {\n                        "button \\"news\\" [ref=e51] [cursor=pointer]": [\n                          "img [ref=e52]",\n                          {\n                            "generic [ref=e57]": "news"\n                          }\n                        ]\n                      },\n                      {\n                        "button \\"science\\" [ref=e58] [cursor=pointer]": [\n                          "img [ref=e59]",\n                          {\n                            "generic [ref=e62]": "science"\n                          }\n                        ]\n                      },\n                      {\n                        "button \\"it\\" [ref=e63] [cursor=pointer]": [\n                          "img [ref=e64]",\n                          {\n                            "generic [ref=e67]": "it"\n                          }\n                        ]\n                      },\n                      {\n                        "button \\"social media\\" [ref=e68] [cursor=pointer]": [\n                          "img [ref=e69]",\n                          {\n                            "generic [ref=e74]": "social media"\n                          }\n                        ]\n                      }\n                    ]\n                  }\n                ]\n              },\n              {\n                "generic [ref=e75]": [\n                  {\n                    "combobox \\"Search language\\" [ref=e76]": [\n                      "option \\"Default language [all]\\"",\n                      "option \\"Auto-detect (en-US)\\" [selected]",\n                      "option \\"Afrikaans [af] ğŸŒ\\"",\n                      "option \\"CatalÃ  [ca] ğŸŒ\\"",\n                      "option \\"Cymraeg [cy] ğŸŒ\\"",\n                      "option \\"Dansk [da] ğŸŒ\\"",\n                      "option \\"Dansk-Danmark [da-DK] ğŸ‡©ğŸ‡°\\"",\n                      "option \\"Deutsch [de] ğŸŒ\\"",\n                      "option \\"Deutsch-Ã–sterreich [de-AT] ğŸ‡¦ğŸ‡¹\\"",\n                      "option \\"Deutsch-Belgien [de-BE] ğŸ‡§ğŸ‡ª\\"",\n                      "option \\"Deutsch-Schweiz [de-CH] ğŸ‡¨ğŸ‡­\\"",\n                      "option \\"Deutsch-Deutschland [de-DE] ğŸ‡©ğŸ‡ª\\"",\n                      "option \\"Eesti [et] ğŸŒ\\"",\n                      "option \\"Eesti-Eesti [et-EE] ğŸ‡ªğŸ‡ª\\"",\n                      "option \\"English [en] ğŸŒ\\"",\n                      "option \\"English-Australia [en-AU] ğŸ‡¦ğŸ‡º\\"",\n                      "option \\"English-Canada [en-CA] ğŸ‡¨ğŸ‡¦\\"",\n                      "option \\"English-United Kingdom [en-GB] ğŸ‡¬ğŸ‡§\\"",\n                      "option \\"English-Ireland [en-IE] ğŸ‡®ğŸ‡ª\\"",\n                      "option \\"English-India [en-IN] ğŸ‡®ğŸ‡³\\"",\n                      "option \\"English-New Zealand [en-NZ] ğŸ‡³ğŸ‡¿\\"",\n                      "option \\"English-Philippines [en-PH] ğŸ‡µğŸ‡­\\"",\n                      "option \\"English-Pakistan [en-PK] ğŸ‡µğŸ‡°\\"",\n                      "option \\"English-Singapore [en-SG] ğŸ‡¸ğŸ‡¬\\"",\n                      "option \\"English-United States [en-US] ğŸ‡ºğŸ‡¸\\"",\n                      "option \\"English-South Africa [en-ZA] ğŸ‡¿ğŸ‡¦\\"",\n                      "option \\"EspaÃ±ol [es] ğŸŒ\\"",\n                      "option \\"EspaÃ±ol-Argentina [es-AR] ğŸ‡¦ğŸ‡·\\"",\n                      "option \\"EspaÃ±ol-Chile [es-CL] ğŸ‡¨ğŸ‡±\\"",\n                      "option \\"EspaÃ±ol-Colombia [es-CO] ğŸ‡¨ğŸ‡´\\"",\n                      "option \\"EspaÃ±ol-EspaÃ±a [es-ES] ğŸ‡ªğŸ‡¸\\"",\n                      "option \\"EspaÃ±ol-MÃ©xico [es-MX] ğŸ‡²ğŸ‡½\\"",\n                      "option \\"EspaÃ±ol-PerÃº [es-PE] ğŸ‡µğŸ‡ª\\"",\n                      "option \\"Euskara [eu] ğŸŒ\\"",\n                      "option \\"FranÃ§ais [fr] ğŸŒ\\"",\n                      "option \\"FranÃ§ais-Belgique [fr-BE] ğŸ‡§ğŸ‡ª\\"",\n                      "option \\"FranÃ§ais-Canada [fr-CA] ğŸ‡¨ğŸ‡¦\\"",\n                      "option \\"FranÃ§ais-Suisse [fr-CH] ğŸ‡¨ğŸ‡­\\"",\n                      "option \\"FranÃ§ais-France [fr-FR] ğŸ‡«ğŸ‡·\\"",\n                      "option \\"Gaeilge [ga] ğŸŒ\\"",\n                      "option \\"Galego [gl] ğŸŒ\\"",\n                      "option \\"GÃ idhlig [gd] ğŸŒ\\"",\n                      "option \\"Hrvatski [hr] ğŸŒ\\"",\n                      "option \\"Indonesia [id] ğŸŒ\\"",\n                      "option \\"Indonesia-Indonesia [id-ID] ğŸ‡®ğŸ‡©\\"",\n                      "option \\"Italiano [it] ğŸŒ\\"",\n                      "option \\"Italiano-Svizzera [it-CH] ğŸ‡¨ğŸ‡­\\"",\n                      "option \\"Italiano-Italia [it-IT] ğŸ‡®ğŸ‡¹\\"",\n                      "option \\"LatvieÅ¡u [lv] ğŸŒ\\"",\n                      "option \\"LietuviÅ³ [lt] ğŸŒ\\"",\n                      "option \\"Magyar [hu] ğŸŒ\\"",\n                      "option \\"Magyar-MagyarorszÃ¡g [hu-HU] ğŸ‡­ğŸ‡º\\"",\n                      "option \\"Nederlands [nl] ğŸŒ\\"",\n                      "option \\"Nederlands-BelgiÃ« [nl-BE] ğŸ‡§ğŸ‡ª\\"",\n                      "option \\"Nederlands-Nederland [nl-NL] ğŸ‡³ğŸ‡±\\"",\n                      "option \\"Norsk BokmÃ¥l [nb] ğŸŒ\\"",\n                      "option \\"Norsk BokmÃ¥l-Norge [nb-NO] ğŸ‡³ğŸ‡´\\"",\n                      "option \\"Polski [pl] ğŸŒ\\"",\n                      "option \\"Polski-Polska [pl-PL] ğŸ‡µğŸ‡±\\"",\n                      "option \\"PortuguÃªs [pt] ğŸŒ\\"",\n                      "option \\"PortuguÃªs-Brasil [pt-BR] ğŸ‡§ğŸ‡·\\"",\n                      "option \\"PortuguÃªs-Portugal [pt-PT] ğŸ‡µğŸ‡¹\\"",\n                      "option \\"RomÃ¢nÄƒ [ro] ğŸŒ\\"",\n                      "option \\"RomÃ¢nÄƒ-RomÃ¢nia [ro-RO] ğŸ‡·ğŸ‡´\\"",\n                      "option \\"Shqip [sq] ğŸŒ\\"",\n                      "option \\"SlovenÄina [sk] ğŸŒ\\"",\n                      "option \\"SlovenÅ¡Äina [sl] ğŸŒ\\"",\n                      "option \\"Suomi [fi] ğŸŒ\\"",\n                      "option \\"Suomi-Suomi [fi-FI] ğŸ‡«ğŸ‡®\\"",\n                      "option \\"Svenska [sv] ğŸŒ\\"",\n                      "option \\"Svenska-Sverige [sv-SE] ğŸ‡¸ğŸ‡ª\\"",\n                      "option \\"Tiáº¿ng Viá»‡t [vi] ğŸŒ\\"",\n                      "option \\"Tiáº¿ng Viá»‡t-Viá»‡t Nam [vi-VN] ğŸ‡»ğŸ‡³\\"",\n                      "option \\"TÃ¼rkÃ§e [tr] ğŸŒ\\"",\n                      "option \\"TÃ¼rkÃ§e-TÃ¼rkiye [tr-TR] ğŸ‡¹ğŸ‡·\\"",\n                      "option \\"Ãslenska [is] ğŸŒ\\"",\n                      "option \\"ÄŒeÅ¡tina [cs] ğŸŒ\\"",\n                      "option \\"ÄŒeÅ¡tina-ÄŒesko [cs-CZ] ğŸ‡¨ğŸ‡¿\\"",\n                      "option \\"Î•Î»Î»Î·Î½Î¹ÎºÎ¬ [el] ğŸŒ\\"",\n                      "option \\"Î•Î»Î»Î·Î½Î¹ÎºÎ¬-Î•Î»Î»Î¬Î´Î± [el-GR] ğŸ‡¬ğŸ‡·\\"",\n                      "option \\"Ğ‘ĞµĞ»Ğ°Ñ€ÑƒÑĞºĞ°Ñ [be] ğŸŒ\\"",\n                      "option \\"Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸ [bg] ğŸŒ\\"",\n                      "option \\"Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸-Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€Ğ¸Ñ [bg-BG] ğŸ‡§ğŸ‡¬\\"",\n                      "option \\"Ğ ÑƒÑÑĞºĞ¸Ğ¹ [ru] ğŸŒ\\"",\n                      "option \\"Ğ ÑƒÑÑĞºĞ¸Ğ¹-Ğ Ğ¾ÑÑĞ¸Ñ [ru-RU] ğŸ‡·ğŸ‡º\\"",\n                      "option \\"Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ° [uk] ğŸŒ\\"",\n                      "option \\"×¢×‘×¨×™×ª [he] ğŸ‡®ğŸ‡±\\"",\n                      "option \\"Ø§Ø±Ø¯Ùˆ [ur] ğŸŒ\\"",\n                      "option \\"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© [ar] ğŸŒ\\"",\n                      "option \\"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©-Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© [ar-SA] ğŸ‡¸ğŸ‡¦\\"",\n                      "option \\"ÙØ§Ø±Ø³ÛŒ [fa] ğŸŒ\\"",\n                      "option \\"à¤®à¤°à¤¾à¤ à¥€ [mr] ğŸŒ\\"",\n                      "option \\"à¤¹à¤¿à¤¨à¥à¤¦à¥€ [hi] ğŸŒ\\"",\n                      "option \\"à®¤à®®à®¿à®´à¯ [ta] ğŸŒ\\"",\n                      "option \\"à°¤à±†à°²à±à°—à± [te] ğŸŒ\\"",\n                      "option \\"à²•à²¨à³à²¨à²¡ [kn] ğŸŒ\\"",\n                      "option \\"à´®à´²à´¯à´¾à´³à´‚ [ml] ğŸŒ\\"",\n                      "option \\"à¹„à¸—à¸¢ [th] ğŸŒ\\"",\n                      "option \\"à¹„à¸—à¸¢-à¹„à¸—à¸¢ [th-TH] ğŸ‡¹ğŸ‡­\\"",\n                      "option \\"ä¸­æ–‡ [zh] ğŸŒ\\"",\n                      "option \\"ä¸­æ–‡-ä¸­å›½ [zh-CN] ğŸ‡¨ğŸ‡³\\"",\n                      "option \\"ä¸­æ–‡-ä¸­åœ‹é¦™æ¸¯ç‰¹åˆ¥è¡Œæ”¿å€ [zh-HK] ğŸ‡­ğŸ‡°\\"",\n                      "option \\"ä¸­æ–‡-å°ç£ [zh-TW] ğŸ‡¹ğŸ‡¼\\"",\n                      "option \\"æ—¥æœ¬èª [ja] ğŸŒ\\"",\n                      "option \\"æ—¥æœ¬èª-æ—¥æœ¬ [ja-JP] ğŸ‡¯ğŸ‡µ\\"",\n                      "option \\"í•œêµ­ì–´ [ko] ğŸŒ\\"",\n                      "option \\"í•œêµ­ì–´-ëŒ€í•œë¯¼êµ­ [ko-KR] ğŸ‡°ğŸ‡·\\""\n                    ]\n                  },\n                  {\n                    "combobox \\"Time range\\" [ref=e77]": [\n                      "option \\"Anytime\\" [selected]",\n                      "option \\"Last day\\"",\n                      "option \\"Last week\\"",\n                      "option \\"Last month\\"",\n                      "option \\"Last year\\""\n                    ]\n                  },\n                  {\n                    "combobox \\"SafeSearch\\" [ref=e78]": [\n                      {\n                        "option \\"Strict\\"": "SafeSearch: Strict"\n                      },\n                      {\n                        "option \\"Moderate\\"": "SafeSearch: Moderate"\n                      },\n                      {\n                        "option \\"None\\" [selected]": "SafeSearch: None"\n                      }\n                    ]\n                  }\n                ]\n              }\n            ]\n          },\n          {\n            "generic [ref=e79]": [\n              {\n                "generic [ref=e80]": [\n                  {\n                    "group [ref=e82]": [\n                      "generic \\"Response time: 1.5 seconds\\" [ref=e83] [cursor=pointer]"\n                    ]\n                  },\n                  {\n                    "complementary \\"Search URL\\" [ref=e84]": [\n                      {\n                        "group [ref=e85]": [\n                          "generic \\"Search URL\\" [ref=e86] [cursor=pointer]"\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "complementary \\"Download results\\" [ref=e87]": [\n                      {\n                        "group [ref=e88]": [\n                          "generic \\"Download results\\" [ref=e89] [cursor=pointer]"\n                        ]\n                      }\n                    ]\n                  }\n                ]\n              },\n              {\n                "main [ref=e91]": [\n                  {\n                    "article [ref=e92]": [\n                      {\n                        "link \\"https://playwright.dev â€º docs â€º test-agents\\" [ref=e93] [cursor=pointer]": [\n                          {\n                            "/url": "https://playwright.dev/docs/test-agents"\n                          },\n                          {\n                            "generic [ref=e94]": [\n                              {\n                                "generic [ref=e95]": "https://playwright.dev"\n                              },\n                              {\n                                "generic [ref=e97]": "â€º docs â€º test-agents"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Agents | Playwright\\" [level=3] [ref=e98]": [\n                          {\n                            "link \\"Agents | Playwright\\" [ref=e99] [cursor=pointer]": [\n                              {\n                                "/url": "https://playwright.dev/docs/test-agents"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e100]": "Playwright Test Agents Introduction Playwright comes with three Playwright Test Agents out of the box: ğŸ­ planner, ğŸ­ generator and ğŸ­ healer. These agents can be used independently, sequentially, or as the chained calls in the agentic loop. Using them sequentially will produce test coverage for your product. ğŸ­ planner explores the app and produces a Markdown test plan ğŸ­ generator ..."\n                      },\n                      {\n                        "generic [ref=e101]": [\n                          {\n                            "generic [ref=e102]": "duckduckgo"\n                          },\n                          "img [ref=e103]",\n                          {\n                            "link \\"cached\\" [ref=e107] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://playwright.dev/docs/test-agents"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e108]": [\n                      {\n                        "link \\"https://github.com â€º microsoft â€º playwright-mcp\\" [ref=e109] [cursor=pointer]": [\n                          {\n                            "/url": "https://github.com/microsoft/playwright-mcp"\n                          },\n                          {\n                            "generic [ref=e110]": [\n                              {\n                                "generic [ref=e111]": "https://github.com"\n                              },\n                              {\n                                "generic [ref=e113]": "â€º microsoft â€º playwright-mcp"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"GitHub - microsoft/playwright-mcp: Playwright MCP server\\" [level=3] [ref=e114]": [\n                          {\n                            "link \\"GitHub - microsoft/playwright-mcp: Playwright MCP server\\" [ref=e115] [cursor=pointer]": [\n                              {\n                                "/url": "https://github.com/microsoft/playwright-mcp"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e116]": "Playwright MCP server. Contribute to microsoft/playwright-mcp development by creating an account on GitHub."\n                      },\n                      {\n                        "generic [ref=e117]": [\n                          {\n                            "generic [ref=e118]": "duckduckgo"\n                          },\n                          "img [ref=e119]",\n                          {\n                            "link \\"cached\\" [ref=e123] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://github.com/microsoft/playwright-mcp"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e124]": [\n                      {\n                        "link \\"https://www.awesome-testing.com â€º 2025 â€º 10 â€º playwright-agents\\" [ref=e125] [cursor=pointer]": [\n                          {\n                            "/url": "https://www.awesome-testing.com/2025/10/playwright-agents"\n                          },\n                          {\n                            "generic [ref=e126]": [\n                              {\n                                "generic [ref=e127]": "https://www.awesome-testing.com"\n                              },\n                              {\n                                "generic [ref=e129]": "â€º 2025 â€º 10 â€º playwright-agents"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Understanding Playwright Agents | Awesome Testing\\" [level=3] [ref=e130]": [\n                          {\n                            "link \\"Understanding Playwright Agents | Awesome Testing\\" [ref=e131] [cursor=pointer]": [\n                              {\n                                "/url": "https://www.awesome-testing.com/2025/10/playwright-agents"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e132]": "A deep dive into Playwright Agents and the Model Context Protocol (MCP) â€” how Microsoft\'s latest AI-powered Playwright release automates test planning, script generation, and self-healing browser tests across Chrome, Firefox, and WebKit."\n                      },\n                      {\n                        "generic [ref=e133]": [\n                          {\n                            "generic [ref=e134]": "duckduckgo"\n                          },\n                          "img [ref=e135]",\n                          {\n                            "link \\"cached\\" [ref=e139] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://www.awesome-testing.com/2025/10/playwright-agents"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e140]": [\n                      {\n                        "link \\"https://medium.com â€º @bluudit â€º playwright-mcp-comprehensive-guide-to-ai-powered-browser-automation-in-2025-712c9fd6cffa\\" [ref=e141] [cursor=pointer]": [\n                          {\n                            "/url": "https://medium.com/@bluudit/playwright-mcp-comprehensive-guide-to-ai-powered-browser-automation-in-2025-712c9fd6cffa"\n                          },\n                          {\n                            "generic [ref=e142]": [\n                              {\n                                "generic [ref=e143]": "https://medium.com"\n                              },\n                              {\n                                "generic [ref=e145]": "â€º @bluudit â€º playwright-mcp-comprehensive-guide-to-ai-powered-browser-automation-in-2025-712c9fd6cffa"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Playwright MCP: Comprehensive Guide to AI-Powered Browser ... - Medium\\" [level=3] [ref=e146]": [\n                          {\n                            "link \\"Playwright MCP: Comprehensive Guide to AI-Powered Browser ... - Medium\\" [ref=e147] [cursor=pointer]": [\n                              {\n                                "/url": "https://medium.com/@bluudit/playwright-mcp-comprehensive-guide-to-ai-powered-browser-automation-in-2025-712c9fd6cffa"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e148]": "Playwright MCP is a Model Context Protocol server that enables LLMs and AI agents to automate browser interactions using Playwright, an open-source tool by Microsoft for cross-browser testing."\n                      },\n                      {\n                        "generic [ref=e149]": [\n                          {\n                            "generic [ref=e150]": "duckduckgo"\n                          },\n                          "img [ref=e151]",\n                          {\n                            "link \\"cached\\" [ref=e155] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://medium.com/@bluudit/playwright-mcp-comprehensive-guide-to-ai-powered-browser-automation-in-2025-712c9fd6cffa"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e156]": [\n                      {\n                        "link \\"https://www.youtube.com â€º watch\\" [ref=e157] [cursor=pointer]": [\n                          {\n                            "/url": "https://www.youtube.com/watch?v=S4qzP07ZkOg"\n                          },\n                          {\n                            "generic [ref=e158]": [\n                              {\n                                "generic [ref=e159]": "https://www.youtube.com"\n                              },\n                              {\n                                "generic [ref=e161]": "â€º watch"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Playwright Live - Playwright Agents & Playwright MCP\\" [level=3] [ref=e162]": [\n                          {\n                            "link \\"Playwright Live - Playwright Agents & Playwright MCP\\" [ref=e163] [cursor=pointer]": [\n                              {\n                                "/url": "https://www.youtube.com/watch?v=S4qzP07ZkOg"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e164]": "Join us for a Playwright Live session where we show off our latest update: Playwright Agents. Let\'s walk though how to use the planner agent so you can gener..."\n                      },\n                      {\n                        "generic [ref=e165]": [\n                          {\n                            "generic [ref=e166]": "duckduckgo"\n                          },\n                          "img [ref=e167]",\n                          {\n                            "link \\"cached\\" [ref=e171] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://www.youtube.com/watch?v=S4qzP07ZkOg"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e172]": [\n                      {\n                        "link \\"https://dev.to â€º debs_obrien â€º letting-playwright-mcp-explore-your-site-and-write-your-tests-mf1\\" [ref=e173] [cursor=pointer]": [\n                          {\n                            "/url": "https://dev.to/debs_obrien/letting-playwright-mcp-explore-your-site-and-write-your-tests-mf1"\n                          },\n                          {\n                            "generic [ref=e174]": [\n                              {\n                                "generic [ref=e175]": "https://dev.to"\n                              },\n                              {\n                                "generic [ref=e177]": "â€º debs_obrien â€º letting-playwright-mcp-explore-your-site-and-write-your-tests-mf1"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Letting Playwright MCP Explore your site and Write your Tests\\" [level=3] [ref=e178]": [\n                          {\n                            "link \\"Letting Playwright MCP Explore your site and Write your Tests\\" [ref=e179] [cursor=pointer]": [\n                              {\n                                "/url": "https://dev.to/debs_obrien/letting-playwright-mcp-explore-your-site-and-write-your-tests-mf1"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e180]": "What if your tests could write themselves â€” just by using your app like a real user? In this post, we explore how the Playwright MCP (Model Context Protocol) in Agent Mode can autonomously navigate your app, discover key functionality, and generate runnable tests â€” no manual scripting required. We\'ll walk through a live demo of generating and running a test against a Movies app ..."\n                      },\n                      {\n                        "generic [ref=e181]": [\n                          {\n                            "generic [ref=e182]": "duckduckgo"\n                          },\n                          "img [ref=e183]",\n                          {\n                            "link \\"cached\\" [ref=e187] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://dev.to/debs_obrien/letting-playwright-mcp-explore-your-site-and-write-your-tests-mf1"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e188]": [\n                      {\n                        "link \\"https://supatest.ai â€º blog â€º playwright-mcp-setup-guide\\" [ref=e189] [cursor=pointer]": [\n                          {\n                            "/url": "https://supatest.ai/blog/playwright-mcp-setup-guide"\n                          },\n                          {\n                            "generic [ref=e190]": [\n                              {\n                                "generic [ref=e191]": "https://supatest.ai"\n                              },\n                              {\n                                "generic [ref=e193]": "â€º blog â€º playwright-mcp-setup-guide"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Playwright MCP Guide: Setup, Configuration & Best Practices\\" [level=3] [ref=e194]": [\n                          {\n                            "link \\"Playwright MCP Guide: Setup, Configuration & Best Practices\\" [ref=e195] [cursor=pointer]": [\n                              {\n                                "/url": "https://supatest.ai/blog/playwright-mcp-setup-guide"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e196]": "Learn how to set up Playwright MCP, connect AI tools, and optimize browser automation with security, performance, and integration best practices"\n                      },\n                      {\n                        "generic [ref=e197]": [\n                          {\n                            "generic [ref=e198]": "duckduckgo"\n                          },\n                          "img [ref=e199]",\n                          {\n                            "link \\"cached\\" [ref=e203] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://supatest.ai/blog/playwright-mcp-setup-guide"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e204]": [\n                      {\n                        "link \\"https://testomat.io â€º blog â€º playwright-mcp-modern-test-automation-from-zero-to-hero\\" [ref=e205] [cursor=pointer]": [\n                          {\n                            "/url": "https://testomat.io/blog/playwright-mcp-modern-test-automation-from-zero-to-hero/"\n                          },\n                          {\n                            "generic [ref=e206]": [\n                              {\n                                "generic [ref=e207]": "https://testomat.io"\n                              },\n                              {\n                                "generic [ref=e209]": "â€º blog â€º playwright-mcp-modern-test-automation-from-zero-to-hero"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"Playwright MCP: A Modern Guide to Test Automation\\" [level=3] [ref=e210]": [\n                          {\n                            "link \\"Playwright MCP: A Modern Guide to Test Automation\\" [ref=e211] [cursor=pointer]": [\n                              {\n                                "/url": "https://testomat.io/blog/playwright-mcp-modern-test-automation-from-zero-to-hero/"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e212]": "Playwright MCP: Modern Test Automation from Zero to Hero Discover the power of Playwright MCP with this comprehensive guide. It walks you through the MCP architecture, set up in the Visual Studio editor with the Codepilot agent mode."\n                      },\n                      {\n                        "generic [ref=e213]": [\n                          {\n                            "generic [ref=e214]": "duckduckgo"\n                          },\n                          "img [ref=e215]",\n                          {\n                            "link \\"cached\\" [ref=e219] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://testomat.io/blog/playwright-mcp-modern-test-automation-from-zero-to-hero/"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e220]": [\n                      {\n                        "link \\"https://playwright.dev â€º community â€º mcp-videos\\" [ref=e221] [cursor=pointer]": [\n                          {\n                            "/url": "https://playwright.dev/community/mcp-videos"\n                          },\n                          {\n                            "generic [ref=e222]": [\n                              {\n                                "generic [ref=e223]": "https://playwright.dev"\n                              },\n                              {\n                                "generic [ref=e225]": "â€º community â€º mcp-videos"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"MCP Videos | Playwright\\" [level=3] [ref=e226]": [\n                          {\n                            "link \\"MCP Videos | Playwright\\" [ref=e227] [cursor=pointer]": [\n                              {\n                                "/url": "https://playwright.dev/community/mcp-videos"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e228]": "MCP Videos Learn about Model Context Protocol (MCP) integration with Playwright Conference Videos Release Videos Live Streams Feature Videos Learn Videos MCP & Agent Videos Playwright Testing Agents: under the hood Playwright Agents, Plan, generate and fix Let AI explore your site and write tests with Playwright MCP"\n                      },\n                      {\n                        "generic [ref=e229]": [\n                          {\n                            "generic [ref=e230]": "duckduckgo"\n                          },\n                          "img [ref=e231]",\n                          {\n                            "link \\"cached\\" [ref=e235] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://playwright.dev/community/mcp-videos"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    "article [ref=e236]": [\n                      {\n                        "link \\"https://www.awesome-testing.com â€º 2025 â€º 07 â€º playwright-mcp\\" [ref=e237] [cursor=pointer]": [\n                          {\n                            "/url": "https://www.awesome-testing.com/2025/07/playwright-mcp"\n                          },\n                          {\n                            "generic [ref=e238]": [\n                              {\n                                "generic [ref=e239]": "https://www.awesome-testing.com"\n                              },\n                              {\n                                "generic [ref=e241]": "â€º 2025 â€º 07 â€º playwright-mcp"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "heading \\"How does Playwright MCP work? | Awesome Testing\\" [level=3] [ref=e242]": [\n                          {\n                            "link \\"How does Playwright MCP work? | Awesome Testing\\" [ref=e243] [cursor=pointer]": [\n                              {\n                                "/url": "https://www.awesome-testing.com/2025/07/playwright-mcp"\n                              }\n                            ]\n                          }\n                        ]\n                      },\n                      {\n                        "paragraph [ref=e244]": "Learn how Playwright MCP combines AI agents, browser automation, and the Model Context Protocol (MCP) to enable intelligent testing, debugging, and documentation. Explore how it works, its architecture, and real-world use cases."\n                      },\n                      {\n                        "generic [ref=e245]": [\n                          {\n                            "generic [ref=e246]": "duckduckgo"\n                          },\n                          "img [ref=e247]",\n                          {\n                            "link \\"cached\\" [ref=e251] [cursor=pointer]": [\n                              {\n                                "/url": "https://web.archive.org/web/https://www.awesome-testing.com/2025/07/playwright-mcp"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  }\n                ]\n              },\n              {\n                "generic": [\n                  {\n                    "link \\"Back to top\\"": [\n                      {\n                        "/url": "#"\n                      },\n                      "img"\n                    ]\n                  }\n                ]\n              },\n              {\n                "navigation [ref=e252]": [\n                  {\n                    "link \\"Next page\\" [ref=e254] [cursor=pointer]": [\n                      {\n                        "text": "Next page"\n                      },\n                      "img [ref=e255]"\n                    ]\n                  },\n                  {\n                    "generic [ref=e257]": [\n                      "link \\"1\\" [ref=e259]",\n                      "link \\"2\\" [ref=e261] [cursor=pointer]",\n                      "link \\"3\\" [ref=e263] [cursor=pointer]",\n                      "link \\"4\\" [ref=e265] [cursor=pointer]",\n                      "link \\"5\\" [ref=e267] [cursor=pointer]",\n                      "link \\"6\\" [ref=e269] [cursor=pointer]",\n                      "link \\"7\\" [ref=e271] [cursor=pointer]",\n                      "link \\"8\\" [ref=e273] [cursor=pointer]",\n                      "link \\"9\\" [ref=e275] [cursor=pointer]",\n                      "link \\"10\\" [ref=e277] [cursor=pointer]"\n                    ]\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      },\n      {\n        "contentinfo [ref=e278]": [\n          {\n            "paragraph [ref=e279]": [\n              {\n                "text": "Powered by"\n              },\n              {\n                "link \\"SearXNG\\" [ref=e280] [cursor=pointer]": [\n                  {\n                    "/url": "/info/en/about"\n                  }\n                ]\n              },\n              {\n                "text": "- 2025.11.18+576c8ca99+dirty â€” a privacy-respecting, open metasearch engine"\n              },\n              {\n                "link \\"Source code\\" [ref=e281] [cursor=pointer]": [\n                  {\n                    "/url": "https://github.com/searxng/searxng"\n                  }\n                ]\n              },\n              {\n                "text": "|"\n              },\n              {\n                "link \\"Issue tracker\\" [ref=e282] [cursor=pointer]": [\n                  {\n                    "/url": "https://github.com/searxng/searxng/issues"\n                  }\n                ]\n              },\n              {\n                "text": "|"\n              },\n              {\n                "link \\"Engine stats\\" [ref=e283] [cursor=pointer]": [\n                  {\n                    "/url": "/stats"\n                  }\n                ]\n              },\n              {\n                "text": "|"\n              },\n              {\n                "link \\"Public instances\\" [ref=e284] [cursor=pointer]": [\n                  {\n                    "/url": "https://searx.space"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n]'
snapshot_json = json.loads(snapshot_str)

elements = extract_all_references_ordered(snapshot_json)

print(f"Found {len(elements)} referenced elements\n")

for el in elements[:8]:  # show first few
    print(el)

# â”€â”€ Save collected tools at the end â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Prepare output directory
if elements:
    BASE_OUTPUT_DIR.mkdir(parents=True, exist_ok=True)
    json_path = BASE_OUTPUT_DIR / "snapshot.json"
    with open(json_path, "w", encoding="utf-8") as f:
        json.dump(elements, f, indent=2, ensure_ascii=False)

    print(f"[green]âœ“ Saved {len(elements)} tools â†’[/green]\n[white]{json_path}[/white]")